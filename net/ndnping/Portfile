# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
PortGroup           github 1.0

github.setup        cawka ndnping v0.2
checksums           rmd160  cf4b078c08c3d28430ac8fda791579597ea05150 \
                    sha256  d883d0c7a215f3992cdc1d573fb6b4544b438c888d98c98ffa754f60cb903568

name                ndnping
homepage            https://github.com/NDN-Routing/ndnping
license             GPL-2+
version             0.2

categories          net
platforms           darwin
maintainers         ucla.edu:alexander.afanasyev

description         ping command equivalent for NDNx

long_description    ndnpingserver and ndnping are NDNx applications used for testing connectivity 

depends_lib-append  port:ndnx

set ndnxuser        ndnx
set ndnxgroup       ndnx
set ndnxdir         ${prefix}/etc/ndnx

patchfiles          patch-wrapper.diff

use_configure       yes
use_autoreconf      yes

configure.args-append   --with-ndn=${prefix}
configure.env-append    OPENSSL_INCLUDES=-I${prefix}/include \
                        OPENSSL_LDFLAGS=-L${prefix}/lib

pre-destroot {
    xinstall -W ${worksrcpath} ndnping ndnpingserver ndnpingserver-wrapper ${destroot}${prefix}/bin/
}

post-destroot {
    # Create a configuration directory, which also a home directory for ${ndnxuser}
    xinstall -d -o ${ndnxuser} -g ${ndnxgroup} "${destroot}${ndnxdir}"

    system "echo /ndn/`/bin/hostname` > \"${destroot}${ndnxdir}/ndnpingserver.conf.example\""
}

notes "
ndnpingserver needs a local prefix to be configured in ${ndnxdir}/ndnpingserver.conf
configuration file.  This file should contain just one line with local prefix, for example: /ndn/ucla.edu
"

startupitem.executable  "${prefix}/bin/ndnpingserver-wrapper"

startupitem.create      yes
startupitem.name        ${name}

startupitem.netchange   no
startupitem.logevents   no
